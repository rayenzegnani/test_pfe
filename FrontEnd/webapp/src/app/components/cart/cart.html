<div class="cart-page">
  <header class="cart-header">
    <div class="container">
      <div class="header-left">
        <button type="button" routerLink="/">&larr; Continue shopping</button>
        <h1>Shopping cart</h1>
      </div>
      <div class="header-right" *ngIf="isLoggedIn">
        <span>Signed in as {{ userName }}</span>
        <button type="button" (click)="logout()">Logout</button>
      </div>
    </div>
  </header>

  <main class="container">
    <section *ngIf="cartItems.length === 0" class="empty-cart">
      <p>Your cart is empty.</p>
      <button type="button" routerLink="/collections">Browse products</button>
    </section>

    <section *ngIf="cartItems.length > 0" class="cart-content">
      <div class="cart-items">
        <div class="cart-items-header">
          <h2>Items ({{ cartItems.length }})</h2>
          <button type="button" (click)="clearCart()">Clear cart</button>
        </div>

        <article *ngFor="let item of cartItems" class="cart-item">
          <div class="item-image">
            <img [src]="getProductImage(item.product)" [alt]="item.product.name" onerror="this.src='https://via.placeholder.com/80?text=No+Image'" />
          </div>
          <div class="item-details">
            <h3>{{ item.product.name }}</h3>
            <div class="item-price">
              <span *ngIf="item.product.discount > 0" class="price-discounted">
                ${{ calculateDiscountedPrice(item.product.purchagePrice, item.product.discount).toFixed(2) }}
              </span>
              <span [class.line-through]="item.product.discount > 0">
                ${{ item.product.purchagePrice?.toFixed(2) }}
              </span>
            </div>
            <div class="item-actions">
              <div class="quantity-controls">
                <button type="button" (click)="updateQuantity(item.product.id, item.quantity - 1)">-</button>
                <span>{{ item.quantity }}</span>
                <button type="button" (click)="updateQuantity(item.product.id, item.quantity + 1)">+</button>
              </div>
              <button type="button" (click)="removeItem(item.product.id)">Remove</button>
            </div>
          </div>
          <div class="item-total">
            ${{ (calculateDiscountedPrice(item.product.purchagePrice, item.product.discount) * item.quantity).toFixed(2) }}
          </div>
        </article>
      </div>

      <aside class="cart-summary">
        <h2>Summary</h2>
        <dl>
          <div>
            <dt>Subtotal</dt>
            <dd>${{ getTotal().toFixed(2) }}</dd>
          </div>
          <div>
            <dt>Estimated tax</dt>
            <dd>${{ (getTotal() * 0.1).toFixed(2) }}</dd>
          </div>
          <div>
            <dt>Shipping</dt>
            <dd>Free</dd>
          </div>
        </dl>
        <div class="summary-total">
          <span>Total</span>
          <strong>${{ (getTotal() * 1.1).toFixed(2) }}</strong>
        </div>
        <button type="button" (click)="checkout()">Proceed to checkout</button>
      </aside>
    </section>
  </main>
</div>
